import{_ as N,c as a,o,a as s,b as D,t as $,n as P,r as d,d as J,h as K,e as b,w as X,F as v,f as m,g as x,v as A,i,j as u,P as p,M as Z,u as ee,k as w,l as j,m as B,p as te}from"./index-UT5iTqAP.js";import{D as se,T as q}from"./mockData-BUIiJdAD.js";const oe={class:"content"},ae={class:"title"},ne={class:"metrics"},le={key:0,class:"thumbnail-container"},ie=["src"],ce={__name:"HotListCard",props:["item","rank"],emits:["click"],setup(r){return(C,h)=>(o(),a("s-card",{clickable:"true",class:"hot-card",onClick:h[0]||(h[0]=l=>C.$emit("click",r.item))},[s("div",{class:P(["rank-badge",{"top-3":r.rank<=3,"top-1":r.rank===1}])},$(r.rank),3),s("div",oe,[s("div",ae,$(r.item.title),1),s("div",ne,$(r.item.metrics),1)]),r.item.thumbnailSrc?(o(),a("div",le,[s("img",{src:r.item.thumbnailSrc,class:"thumbnail",onerror:"this.style.display='none'"},null,8,ie)])):D("",!0)]))}},re=N(ce,[["__scopeId","data-v-46bb91cd"]]),de={key:0,class:"desktop-header"},ue={style:{"justify-content":"center"}},he=["selected","onClick"],ve={slot:"text"},me={class:"content-area"},_e={class:"tab-content"},fe={class:"card-grid"},ke={class:"load-more"},ge={key:0,class:"end-marker"},ye={class:"tab-content"},pe={class:"card-grid"},Ce={class:"list-layout"},be={class:"card-grid"},we={class:"tab-content"},$e={class:"list-layout"},Te={class:"tab-content"},Le={class:"card-grid"},Re={key:1,class:"mobile-nav"},xe={mode:"bottom"},Ae=["selected","onClick"],De={slot:"text"},He={__name:"HomeView",setup(r){const C=ee(),h=d(!1),l=d("recommend"),S=d("selected"),f=d([]),T=d(!0),H=d(!1),M=d([]),I=d(!1),E=d([...se]),U=[{id:"recommend",label:"推荐",icon:"home"},{id:"following",label:"关注",icon:"group"},{id:"hot",label:"热榜",icon:"local_fire_department"},{id:"thoughts",label:"想法",icon:"emoji_objects"}],G=[{id:"selected",label:"精选"},{id:"latest",label:"最新"},{id:"thoughts",label:"想法"}],V=()=>{typeof window<"u"&&(h.value=window.innerWidth<768)};J(()=>{V(),window.addEventListener("resize",V),z(!0)});const k=n=>{const c=b.getDataType(n),e=b.getId(n);c=="question"?C.push(`/question/${n.id}`):C.push(`/article/${c}/${e}`)},L=n=>{C.push(`/user/${n}`)},z=async(n=!1)=>{if(!H.value){H.value=!0;try{const c=await K.get("https://api.zhihu.com/topstory/recommend",{isWWW:!0}),e=(c.data||[]).map(t=>{const _=b.formatTitle(t),y=b.getDataType(t),R=b.getId(t),F=`./content/${y}/${R}`;return{...t,id:R,title:_||"无标题",excerpt:t.target?.excerpt||t.excerpt||"",metrics:{likes:t.target?.voteup_count||0,comments:t.target?.comment_count||0},author:t.target?.author||t.author,href:F}});n?f.value=e:f.value=[...f.value,...e],T.value=!c.paging?.is_end}catch(c){console.error("Failed to fetch recommend data",c)}finally{H.value=!1}}},W=async()=>{if(!I.value){I.value=!0;try{const e=((await $zhihu.get("https://api.zhihu.com/topstory/hot-lists/total?limit=50&mobile=true")).data||[]).map((t,_)=>{const y=t.target||{},R=y.image_area||{},F=y.title_area||{},Q=y.metrics_area||{},Y=y.link||{};return console.log(t),{id:t.card_id.split("Q_")[1],rank:_+1,title:F.text||"无标题",metricsArea:Q.text||"",url:Y.url||"",type:"question",thumbnailSrc:R.url||""}});M.value=e}catch(n){console.error("Failed to fetch hot data",n)}finally{I.value=!1}}},g=async()=>{l.value==="recommend"?await z(!0):l.value==="hot"?await W():await new Promise(n=>setTimeout(n,1e3))},O=()=>{l.value==="recommend"&&T.value&&z(!1)};return X(l,n=>{n==="hot"&&M.value.length===0&&W()}),(n,c)=>(o(),a("div",{class:P(["home-view",{"is-mobile":h.value,"is-desktop":!h.value}])},[h.value?D("",!0):(o(),a("div",de,[s("s-tab",ue,[(o(),a(v,null,m(U,e=>s("s-tab-item",{key:e.id,selected:l.value===e.id,onClick:t=>l.value=e.id},[s("div",ve,$(e.label),1)],8,he)),64))])])),s("div",me,[x(s("div",_e,[i(p,{onRefresh:g,onLoadMore:T.value?O:null},{default:u(()=>[s("div",fe,[(o(!0),a(v,null,m(f.value,(e,t)=>(o(),a("div",{class:"masonry-item",key:e.id+"-"+t},[i(w,{item:e,onClick:_=>k(e),onUserClick:L},null,8,["item","onClick"])]))),128)),s("div",ke,[!T.value&&f.value.length>0?(o(),a("div",ge,"没有更多内容了")):D("",!0)])])]),_:1},8,["onLoadMore"])],512),[[A,l.value==="recommend"]]),x(s("div",ye,[i(Z,{tabs:G,activeId:S.value,onChange:e=>S.value=e},{selected:u(()=>[i(p,{onRefresh:g},{default:u(()=>[s("div",pe,[(o(!0),a(v,null,m(f.value.slice(0,2),(e,t)=>(o(),a("div",{key:"sel-"+t,class:"masonry-item"},[i(w,{item:e,onClick:_=>k(e),onUserClick:L},null,8,["item","onClick"])]))),128))])]),_:1})]),latest:u(()=>[i(p,{onRefresh:g},{default:u(()=>[s("div",Ce,[(o(!0),a(v,null,m(E.value,(e,t)=>(o(),B(w,{key:"lat-"+t,item:e,onClick:_=>k(e)},null,8,["item","onClick"]))),128)),c[0]||(c[0]=s("div",{class:"end-marker"},"已加载全部最新内容",-1))])]),_:1})]),thoughts:u(()=>[i(p,{onRefresh:g},{default:u(()=>[s("div",be,[(o(!0),a(v,null,m(j(q),e=>(o(),a("div",{key:e.id,class:"masonry-item"},[i(w,{item:e,isThought:"",onClick:t=>k(e),onUserClick:L},null,8,["item","onClick"])]))),128))])]),_:1})]),_:1},8,["activeId","onChange"])],512),[[A,l.value==="following"]]),x(s("div",we,[i(p,{onRefresh:g},{default:u(()=>[s("div",$e,[(o(!0),a(v,null,m(M.value,(e,t)=>(o(),B(re,{key:e.id,item:e,rank:t+1,onClick:_=>k(e)},null,8,["item","rank","onClick"]))),128))])]),_:1})],512),[[A,l.value==="hot"]]),x(s("div",Te,[i(p,{onRefresh:g},{default:u(()=>[s("div",Le,[(o(!0),a(v,null,m(j(q),e=>(o(),a("div",{key:"t-"+e.id,class:"masonry-item"},[i(w,{item:e,isThought:"",onClick:t=>k(e),onUserClick:L},null,8,["item","onClick"])]))),128))])]),_:1})],512),[[A,l.value==="thoughts"]])]),h.value?(o(),a("div",Re,[s("s-navigation",xe,[(o(),a(v,null,m(U,e=>s("s-navigation-item",{key:e.id,selected:l.value===e.id,onClick:t=>l.value=e.id},[i(te,{slot:"icon",icon:e.icon,fill:l.value===e.id},null,8,["icon","fill"]),s("div",De,$(e.label),1)],8,Ae)),64))])])):D("",!0)],2))}},ze=N(He,[["__scopeId","data-v-c77edaef"]]);export{ze as default};
