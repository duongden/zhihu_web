import{C as e,D as t,E as n,S as r,T as i,_ as a,a as o,b as s,c,d as l,f as u,i as d,l as f,m as p,n as m,o as h,p as g,r as _,s as ee,t as v,u as y,v as te,w as b,x as ne,y as x}from"./index-adaj_QdM.js";import{r as S,t as C}from"./mockData-QDqH7q9Q.js";var w={class:`content`},T={class:`title`},E={class:`metrics`},D={key:0,class:`thumbnail-container`},O=[`src`],re=h({__name:`HotListCard`,props:[`item`,`rank`],emits:[`click`],setup(e){return(r,i)=>(x(),p(`s-card`,{clickable:`true`,class:`hot-card`,onClick:i[0]||=t=>r.$emit(`click`,e.item)},[l(`div`,{class:n([`rank-badge`,{"top-3":e.rank<=3,"top-1":e.rank===1}])},t(e.rank),3),l(`div`,w,[l(`div`,T,t(e.item.title),1),l(`div`,E,t(e.item.metrics),1)]),e.item.thumbnailSrc?(x(),p(`div`,D,[l(`img`,{src:e.item.thumbnailSrc,class:`thumbnail`,onerror:`this.style.display='none'`},null,8,O)])):g(``,!0)]))}},[[`__scopeId`,`data-v-46bb91cd`]]),ie={key:0,class:`desktop-header`},ae={style:{"justify-content":`center`}},oe=[`selected`,`onClick`],se={slot:`text`},ce={class:`content-area`},le={class:`tab-content`},ue={class:`card-grid`},k={class:`load-more`},A={key:0,class:`end-marker`},j={class:`tab-content`},M={class:`card-grid`},N={class:`list-layout`},P={class:`card-grid`},F={class:`tab-content`},I={class:`list-layout`},L={class:`tab-content`},R={class:`card-grid`},z={key:1,class:`mobile-nav`},B={mode:`bottom`},V=[`selected`,`onClick`],H={slot:`text`},U=h({__name:`HomeView`,setup(h){let w=c(),T=b(!1),E=b(`recommend`),D=b(`selected`),O=b([]),U=b(!0),W=b(!1),G=b([]),K=b(!1),de=b([...C]),q=[{id:`recommend`,label:`推荐`,icon:`home`},{id:`following`,label:`关注`,icon:`group`},{id:`hot`,label:`热榜`,icon:`local_fire_department`},{id:`thoughts`,label:`想法`,icon:`emoji_objects`}],fe=[{id:`selected`,label:`精选`},{id:`latest`,label:`最新`},{id:`thoughts`,label:`想法`}],J=()=>{typeof window<`u`&&(T.value=window.innerWidth<768)};te(()=>{J(),window.addEventListener(`resize`,J),Z(!0)});let Y=e=>{let t=v.getDataType(e),n=v.getId(e);t==`question`?w.push(`/question/${e.id}`):w.push(`/article/${t}/${n}`)},X=e=>{w.push(`/user/${e}`)},Z=async(e=!1)=>{if(!W.value){W.value=!0;try{let t=await o.get(`https://api.zhihu.com/topstory/recommend`,{isWWW:!0}),n=(t.data||[]).map(e=>{let t=v.formatTitle(e),n=v.getDataType(e),r=v.getId(e),i=`./content/${n}/${r}`;return{...e,id:r,title:t||`无标题`,excerpt:e.target?.excerpt||e.excerpt||``,metrics:{likes:e.target?.voteup_count||0,comments:e.target?.comment_count||0},author:e.target?.author||e.author,href:i}});e?O.value=n:O.value=[...O.value,...n],U.value=!t.paging?.is_end}catch(e){console.error(`Failed to fetch recommend data`,e)}finally{W.value=!1}}},Q=async()=>{if(!K.value){K.value=!0;try{G.value=((await $zhihu.get(`https://api.zhihu.com/topstory/hot-lists/total?limit=50&mobile=true`)).data||[]).map((e,t)=>{let n=e.target||{},r=n.image_area||{},i=n.title_area||{},a=n.metrics_area||{},o=n.link||{};return console.log(e),{id:e.card_id.split(`Q_`)[1],rank:t+1,title:i.text||`无标题`,metricsArea:a.text||``,url:o.url||``,type:`question`,thumbnailSrc:r.url||``}})}catch(e){console.error(`Failed to fetch hot data`,e)}finally{K.value=!1}}},$=async()=>{E.value===`recommend`?await Z(!0):E.value===`hot`?await Q():await new Promise(e=>setTimeout(e,1e3))},pe=()=>{E.value===`recommend`&&U.value&&Z(!1)};return ne(E,e=>{e===`hot`&&G.value.length===0&&Q()}),(o,c)=>(x(),p(`div`,{class:n([`home-view`,{"is-mobile":T.value,"is-desktop":!T.value}])},[T.value?g(``,!0):(x(),p(`div`,ie,[l(`s-tab`,ae,[(x(),p(y,null,s(q,e=>l(`s-tab-item`,{key:e.id,selected:E.value===e.id,onClick:t=>E.value=e.id},[l(`div`,se,t(e.label),1)],8,oe)),64))])])),l(`div`,ce,[e(l(`div`,le,[a(m,{onRefresh:$,onLoadMore:U.value?pe:null},{default:r(()=>[l(`div`,ue,[(x(!0),p(y,null,s(O.value,(e,t)=>(x(),p(`div`,{class:`masonry-item`,key:e.id+`-`+t},[a(d,{item:e,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128)),l(`div`,k,[!U.value&&O.value.length>0?(x(),p(`div`,A,`没有更多内容了`)):g(``,!0)])])]),_:1},8,[`onLoadMore`])],512),[[f,E.value===`recommend`]]),e(l(`div`,j,[a(_,{tabs:fe,activeId:D.value,onChange:e=>D.value=e},{selected:r(()=>[a(m,{onRefresh:$},{default:r(()=>[l(`div`,M,[(x(!0),p(y,null,s(O.value.slice(0,2),(e,t)=>(x(),p(`div`,{key:`sel-`+t,class:`masonry-item`},[a(d,{item:e,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})]),latest:r(()=>[a(m,{onRefresh:$},{default:r(()=>[l(`div`,N,[(x(!0),p(y,null,s(de.value,(e,t)=>(x(),u(d,{key:`lat-`+t,item:e,onClick:t=>Y(e)},null,8,[`item`,`onClick`]))),128)),c[0]||=l(`div`,{class:`end-marker`},`已加载全部最新内容`,-1)])]),_:1})]),thoughts:r(()=>[a(m,{onRefresh:$},{default:r(()=>[l(`div`,P,[(x(!0),p(y,null,s(i(S),e=>(x(),p(`div`,{key:e.id,class:`masonry-item`},[a(d,{item:e,isThought:``,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})]),_:1},8,[`activeId`,`onChange`])],512),[[f,E.value===`following`]]),e(l(`div`,F,[a(m,{onRefresh:$},{default:r(()=>[l(`div`,I,[(x(!0),p(y,null,s(G.value,(e,t)=>(x(),u(re,{key:e.id,item:e,rank:t+1,onClick:t=>Y(e)},null,8,[`item`,`rank`,`onClick`]))),128))])]),_:1})],512),[[f,E.value===`hot`]]),e(l(`div`,L,[a(m,{onRefresh:$},{default:r(()=>[l(`div`,R,[(x(!0),p(y,null,s(i(S),e=>(x(),p(`div`,{key:`t-`+e.id,class:`masonry-item`},[a(d,{item:e,isThought:``,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})],512),[[f,E.value===`thoughts`]])]),T.value?(x(),p(`div`,z,[l(`s-navigation`,B,[(x(),p(y,null,s(q,e=>l(`s-navigation-item`,{key:e.id,selected:E.value===e.id,onClick:t=>E.value=e.id},[a(ee,{slot:`icon`,icon:e.icon,fill:E.value===e.id},null,8,[`icon`,`fill`]),l(`div`,H,t(e.label),1)],8,V)),64))])])):g(``,!0)],2))}},[[`__scopeId`,`data-v-c77edaef`]]);export{U as default};