import{g as e,n as t,t as n}from"./homeCardRender-CHQhGPHa.js";import{A as r,C as i,D as a,E as o,J as s,N as c,O as l,X as u,c as d,l as f,m as p,n as m,o as h,s as g,t as _,x as v,y as ee}from"./_plugin-vue_export-helper-DKZfpah6.js";import{a as te}from"./vue-router-CjU1PN9w.js";import{t as ne}from"./MaterialSymbol-BcLKmkdh.js";import{n as y,t as b}from"./PullToRefresh-Y0fR0lU5.js";import{t as re}from"./MobileTabLayout-BhSA-Y1y.js";import{r as x,t as S}from"./mockData-CNJqbgoH.js";var C={class:`content`},w={class:`title`},T={class:`metrics`},E={key:0,class:`thumbnail-container`},D=[`src`],ie=_({__name:`HotListCard`,props:[`item`,`rank`],emits:[`click`],setup(e){return(t,n)=>(v(),f(`s-card`,{clickable:`true`,class:`hot-card`,onClick:n[0]||=n=>t.$emit(`click`,e.item)},[h(`div`,{class:s([`rank-badge`,{"top-3":e.rank<=3,"top-1":e.rank===1}])},u(e.rank),3),h(`div`,C,[h(`div`,w,u(e.item.title),1),h(`div`,T,u(e.item.metrics),1)]),e.item.thumbnailSrc?(v(),f(`div`,E,[h(`img`,{src:e.item.thumbnailSrc,class:`thumbnail`,onerror:`this.style.display='none'`},null,8,D)])):d(``,!0)]))}},[[`__scopeId`,`data-v-46bb91cd`]]),ae={key:0,class:`desktop-header`},oe={style:{"justify-content":`center`}},se=[`selected`,`onClick`],ce={slot:`text`},le={class:`content-area`},ue={class:`tab-content`},de={class:`card-grid`},O={class:`load-more`},k={key:0,class:`end-marker`},A={class:`tab-content`},j={class:`card-grid`},M={class:`list-layout`},N={class:`card-grid`},P={class:`tab-content`},F={class:`list-layout`},I={class:`tab-content`},L={class:`card-grid`},R={key:1,class:`mobile-nav`},z={mode:`bottom`},B=[`selected`,`onClick`],V={slot:`text`},H=_({__name:`HomeView`,setup(_){let C=te(),w=r(!1),T=r(`recommend`),E=r(`selected`),D=r([]),H=r(!0),U=r(!1),W=r([]),G=r(!1),fe=r([...S]),K=[{id:`recommend`,label:`推荐`,icon:`home`},{id:`following`,label:`关注`,icon:`group`},{id:`hot`,label:`热榜`,icon:`local_fire_department`},{id:`thoughts`,label:`想法`,icon:`emoji_objects`}],q=[{id:`selected`,label:`精选`},{id:`latest`,label:`最新`},{id:`thoughts`,label:`想法`}],J=()=>{typeof window<`u`&&(w.value=window.innerWidth<768)};ee(()=>{J(),window.addEventListener(`resize`,J),Z(!0)});let Y=e=>{let t=n.getDataType(e),r=n.getId(e);t==`question`?C.push(`/question/${e.id}`):C.push(`/article/${t}/${r}`)},X=e=>{C.push(`/user/${e}`)},Z=async(e=!1)=>{if(!U.value){U.value=!0;try{let r=await t.get(`https://api.zhihu.com/topstory/recommend`,{isWWW:!0}),i=(r.data||[]).map(e=>{let t=n.formatTitle(e),r=n.getDataType(e),i=n.getId(e),a=`./content/${r}/${i}`;return{...e,id:i,title:t||`无标题`,excerpt:e.target?.excerpt||e.excerpt||``,metrics:{likes:e.target?.voteup_count||0,comments:e.target?.comment_count||0},author:e.target?.author||e.author,href:a}});e?D.value=i:D.value=[...D.value,...i],H.value=!r.paging?.is_end}catch(e){console.error(`Failed to fetch recommend data`,e)}finally{U.value=!1}}},Q=async()=>{if(!G.value){G.value=!0;try{W.value=((await $zhihu.get(`https://api.zhihu.com/topstory/hot-lists/total?limit=50&mobile=true`)).data||[]).map((e,t)=>{let n=e.target||{},r=n.image_area||{},i=n.title_area||{},a=n.metrics_area||{},o=n.link||{};return{id:e.card_id.split(`Q_`)[1],rank:t+1,title:i.text||`无标题`,metricsArea:a.text||``,url:o.url||``,type:`question`,thumbnailSrc:r.url||``}})}catch(e){console.error(`Failed to fetch hot data`,e)}finally{G.value=!1}}},$=async()=>{T.value===`recommend`?await Z(!0):T.value===`hot`?await Q():await new Promise(e=>setTimeout(e,1e3))},pe=()=>{T.value===`recommend`&&H.value&&Z(!1)};return o(T,e=>{e===`hot`&&W.value.length===0&&Q()}),(t,n)=>(v(),f(`div`,{class:s([`home-view`,{"is-mobile":w.value,"is-desktop":!w.value}])},[w.value?d(``,!0):(v(),f(`div`,ae,[h(`s-tab`,oe,[(v(),f(m,null,i(K,e=>h(`s-tab-item`,{key:e.id,selected:T.value===e.id,onClick:t=>T.value=e.id},[h(`div`,ce,u(e.label),1)],8,se)),64))])])),h(`div`,le,[l(h(`div`,ue,[p(b,{onRefresh:$,onLoadMore:H.value?pe:null},{default:a(()=>[h(`div`,de,[(v(!0),f(m,null,i(D.value,(e,t)=>(v(),f(`div`,{class:`masonry-item`,key:e.id+`-`+t},[p(y,{item:e,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128)),h(`div`,O,[!H.value&&D.value.length>0?(v(),f(`div`,k,`没有更多内容了`)):d(``,!0)])])]),_:1},8,[`onLoadMore`])],512),[[e,T.value===`recommend`]]),l(h(`div`,A,[p(re,{tabs:q,activeId:E.value,onChange:e=>E.value=e},{selected:a(()=>[p(b,{onRefresh:$},{default:a(()=>[h(`div`,j,[(v(!0),f(m,null,i(D.value.slice(0,2),(e,t)=>(v(),f(`div`,{key:`sel-`+t,class:`masonry-item`},[p(y,{item:e,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})]),latest:a(()=>[p(b,{onRefresh:$},{default:a(()=>[h(`div`,M,[(v(!0),f(m,null,i(fe.value,(e,t)=>(v(),g(y,{key:`lat-`+t,item:e,onClick:t=>Y(e)},null,8,[`item`,`onClick`]))),128)),n[0]||=h(`div`,{class:`end-marker`},`已加载全部最新内容`,-1)])]),_:1})]),thoughts:a(()=>[p(b,{onRefresh:$},{default:a(()=>[h(`div`,N,[(v(!0),f(m,null,i(c(x),e=>(v(),f(`div`,{key:e.id,class:`masonry-item`},[p(y,{item:e,isThought:``,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})]),_:1},8,[`activeId`,`onChange`])],512),[[e,T.value===`following`]]),l(h(`div`,P,[p(b,{onRefresh:$},{default:a(()=>[h(`div`,F,[(v(!0),f(m,null,i(W.value,(e,t)=>(v(),g(ie,{key:e.id,item:e,rank:t+1,onClick:t=>Y(e)},null,8,[`item`,`rank`,`onClick`]))),128))])]),_:1})],512),[[e,T.value===`hot`]]),l(h(`div`,I,[p(b,{onRefresh:$},{default:a(()=>[h(`div`,L,[(v(!0),f(m,null,i(c(x),e=>(v(),f(`div`,{key:`t-`+e.id,class:`masonry-item`},[p(y,{item:e,isThought:``,onClick:t=>Y(e),onUserClick:X},null,8,[`item`,`onClick`])]))),128))])]),_:1})],512),[[e,T.value===`thoughts`]])]),w.value?(v(),f(`div`,R,[h(`s-navigation`,z,[(v(),f(m,null,i(K,e=>h(`s-navigation-item`,{key:e.id,selected:T.value===e.id,onClick:t=>T.value=e.id},[p(ne,{slot:`icon`,icon:e.icon,fill:T.value===e.id},null,8,[`icon`,`fill`]),h(`div`,V,u(e.label),1)],8,B)),64))])])):d(``,!0)],2))}},[[`__scopeId`,`data-v-99592c70`]]);export{H as default};